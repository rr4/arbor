var Node=function(t){this._id=_nextNodeId++,this.data=t||{},this._mass=void 0!==t.mass?t.mass:1,this._fixed=!0===t.fixed,this._p=new Point("number"==typeof t.x?t.x:null,"number"==typeof t.y?t.y:null),delete this.data.x,delete this.data.y,delete this.data.mass,delete this.data.fixed},_nextNodeId=1,Edge=function(t,i,n){this._id=_nextEdgeId--,this.source=t,this.target=i,this.length=void 0!==n.length?n.length:1,this.data=void 0!==n?n:{},delete this.data.length},_nextEdgeId=-1,Particle=function(t,i){this.p=t,this.m=i,this.v=new Point(0,0),this.f=new Point(0,0)};Particle.prototype.applyForce=function(t){this.f=this.f.add(t.divide(this.m))};var Spring=function(t,i,n,e){this.point1=t,this.point2=i,this.length=n,this.k=e};Spring.prototype.distanceToParticle=function(t){var i=that.point2.p.subtract(that.point1.p).normalize().normal(),n=t.p.subtract(that.point1.p);return Math.abs(n.x*i.x+n.y*i.y)};var Point=function(t,i){t&&t.hasOwnProperty("y")&&(i=t.y,t=t.x),this.x=t,this.y=i};Point.random=function(t){return t=void 0!==t?t:5,new Point(2*t*(Math.random()-.5),2*t*(Math.random()-.5))},Point.prototype={exploded:function(){return isNaN(this.x)||isNaN(this.y)},add:function(t){return new Point(this.x+t.x,this.y+t.y)},subtract:function(t){return new Point(this.x-t.x,this.y-t.y)},multiply:function(t){return new Point(this.x*t,this.y*t)},divide:function(t){return new Point(this.x/t,this.y/t)},magnitude:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normal:function(){return new Point(-this.y,this.x)},normalize:function(){return this.divide(this.magnitude())}};