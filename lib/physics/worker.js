importScripts("atoms.js"),importScripts("barnes-hut.js"),importScripts("physics.js"),$={each:function(t,s){if($.isArray(t))for(var i=0,e=t.length;i<e;i++)s(i,t[i]);else for(var n in t)s(n,t[n])},map:function(t,s){var i=[];return $.each(t,function(t,e){var n=s(e,t);void 0!==n&&i.push(n)}),i},isArray:function(t){return-1!=t.constructor.toString().indexOf("Array")},inArray:function(t,s){for(var i=0,e=s.length;i<e;i++)if(s[i]===t)return i;return-1}};var PhysicsWorker=function(){var t=20,s=null,i=null,e=null,n=((new Date).valueOf(),{init:function(t){return n.timeout(t.timeout),s=Physics(t.dt,t.stiffness,t.repulsion,t.friction,n.tock),n},timeout:function(s){s!=t&&(t=s,null!==i&&(n.stop(),n.go()))},go:function(){null===i&&(e=null,i=setInterval(n.tick,t))},stop:function(){null!==i&&(clearInterval(i),i=null)},tick:function(){s.tick();var t=s.systemEnergy();(t.mean+t.max)/2<.05?(null===e&&(e=(new Date).valueOf()),(new Date).valueOf()-e>1e3&&n.stop()):e=null},tock:function(t){t.type="geometry",postMessage(t)},modifyNode:function(t,i){s.modifyNode(t,i),n.go()},modifyPhysics:function(t){s.modifyPhysics(t)},update:function(t){s._update(t)}});return n},physics=PhysicsWorker();onmessage=function(t){if(t.data.type)if("physics"!=t.data.type)switch(t.data.type){case"modify":physics.modifyNode(t.data.id,t.data.mods);break;case"changes":physics.update(t.data.changes),physics.go();break;case"start":physics.go();break;case"stop":physics.stop();break;case"sys":s=t.data.param||{};isNaN(s.timeout)||physics.timeout(s.timeout),physics.modifyPhysics(s),physics.go()}else{var s=t.data.physics;physics.init(t.data.physics)}else postMessage("¿kérnèl?")};